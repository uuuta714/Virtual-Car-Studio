!function(){function t(t,a){return function(t){if("string"!=typeof t||!t.match(/^data:image\/webp;base64,/i))throw Error("Failed to decode WebP Base64 URL");return window.atob(t.substring(23))}("string"==typeof t&&/^data:image\/webp/.test(t)?t:t.toDataURL("image/webp",a))}function a(t){let a=t.indexOf("VP8",12);if(-1===a)throw Error("Bad image format, does this browser support WebP?");let e=!1;for(;a<t.length-8;){var i;let r,d;switch(d=t.substring(a,a+4),a+=4,r=((i=t.substring(a,a+4)).charCodeAt(0)|i.charCodeAt(1)<<8|i.charCodeAt(2)<<16|i.charCodeAt(3)<<24)>>>0,a+=4,d){case"VP8 ":return{frame:t.substring(a,a+r),hasAlpha:e};case"ALPH":e=!0}a+=r,(1&r)!=0&&a++}throw Error("Failed to find VP8 keyframe in WebP image, is this image mistakenly encoded in the Lossless WebP format?")}function e(t){this.value=t}function i(t){this.value=t}function r(t,a,d){if(Array.isArray(d))for(let e=0;e<d.length;e++)r(t,a,d[e]);else if("string"==typeof d)t.writeString(d);else if(d instanceof Uint8Array)t.writeBytes(d);else if(d.id){if(d.offset=t.pos+a,t.writeUnsignedIntBE(d.id),Array.isArray(d.data)){let e,i,n;-1===d.size?t.writeByte(255):-2===d.size?(e=t.pos,t.writeBytes([15,255,255,255,255])):(e=t.pos,t.writeBytes([0,0,0,0])),i=t.pos,d.dataOffset=i+a,r(t,a,d.data),-1!==d.size&&-2!==d.size&&(n=t.pos,d.size=n-i,t.seek(e),t.writeEBMLVarIntWidth(d.size,4),t.seek(n))}else if("string"==typeof d.data)t.writeEBMLVarInt(d.data.length),d.dataOffset=t.pos+a,t.writeString(d.data);else if("number"==typeof d.data)d.size||(d.size=t.measureUnsignedInt(d.data)),t.writeEBMLVarInt(d.size),d.dataOffset=t.pos+a,t.writeUnsignedIntBE(d.data,d.size);else if(d.data instanceof i)t.writeEBMLVarInt(8),d.dataOffset=t.pos+a,t.writeDoubleBE(d.data.value);else if(d.data instanceof e)t.writeEBMLVarInt(4),d.dataOffset=t.pos+a,t.writeFloatBE(d.data.value);else if(d.data instanceof Uint8Array)t.writeEBMLVarInt(d.data.byteLength),d.dataOffset=t.pos+a,t.writeBytes(d.data);else throw Error("Bad EBML datatype "+typeof d.data)}else throw Error("Bad EBML datatype "+typeof d.data)}let d=function(e,d){return function(n){let s,o=!1,f=0,l=0,u=null,h=null,w=null,p=[],m=0,c=0,g={Cues:{id:new Uint8Array([28,83,187,107]),positionEBML:null},SegmentInfo:{id:new Uint8Array([21,73,169,102]),positionEBML:null},Tracks:{id:new Uint8Array([22,84,174,107]),positionEBML:null}},y,B={id:17545,data:new i(0)},b,E=[],A=new d(n.fileWriter||n.fd);function M(t){return t-y.dataOffset}function L(){b=function(){let t={id:21420,size:5,data:0},a={id:290298740,data:[]};for(let e in g){let i=g[e];i.positionEBML=Object.create(t),a.data.push({id:19899,data:[{id:21419,data:i.id},i.positionEBML]})}return a}();let t={id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:"webm-writer-js"},{id:22337,data:"webm-writer-js"},B]},a=[{id:176,data:f},{id:186,data:l}];n.transparent&&a.push({id:21440,data:1});let i={id:374648427,data:[{id:174,data:[{id:215,data:1},{id:29637,data:1},{id:156,data:0},{id:2274716,data:"und"},{id:134,data:"V_VP8"},{id:2459272,data:"VP8"},{id:131,data:1},{id:224,data:a}]}]};y={id:408125543,size:-2,data:[b,t,i]};let d=new e(256);r(d,A.pos,[{id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:"webm"},{id:17031,data:2},{id:17029,data:2}]},y]),A.write(d.getAsDataArray()),g.SegmentInfo.positionEBML.data=M(t.offset),g.Tracks.positionEBML.data=M(i.offset),o=!0}function k(){var t,a,i;if(0===p.length)return;let d=0;for(let t=0;t<p.length;t++)d+=p[t].frame.length+(p[t].alpha?p[t].alpha.length:0);let n=new e(d+64*p.length),s={id:524531317,data:[{id:231,data:Math.round(Math.round(m))}]};for(let a=0;a<p.length;a++)s.data.push((t=p[a]).alpha?function(t){let a=new e(4);if(!(t.trackNumber>0&&t.trackNumber<127))throw Error("TrackNumber must be > 0 and < 127");return a.writeEBMLVarInt(t.trackNumber),a.writeU16BE(t.timecode),a.writeByte(0),{id:160,data:[{id:161,data:[a.getAsDataArray(),t.frame]},{id:30113,data:[{id:166,data:[{id:238,data:1},{id:165,data:t.alpha}]}]}]}}(t):function(t){let a=new e(4);if(!(t.trackNumber>0&&t.trackNumber<127))throw Error("TrackNumber must be > 0 and < 127");return a.writeEBMLVarInt(t.trackNumber),a.writeU16BE(t.timecode),a.writeByte(128),{id:163,data:[a.getAsDataArray(),t.frame]}}(t));r(n,A.pos,s),A.write(n.getAsDataArray()),a=Math.round(m),i=s.offset,E.push({id:187,data:[{id:179,data:a},{id:183,data:[{id:247,data:1},{id:241,data:M(i)}]}]}),p=[],m+=c,c=0}this.addFrame=function(e,i,r){var d;o||(f=e.width||0,l=e.height||0,L());let s=a(t(e,n.quality)),m,g=null;m=r||("number"==typeof i?i:n.frameDuration),n.transparent&&(i instanceof HTMLCanvasElement||"string"==typeof i?g=i:s.hasAlpha&&(g=function(t){(null===u||u.width!==t.width||u.height!==t.height)&&((u=document.createElement("canvas")).width=t.width,u.height=t.height,w=(h=u.getContext("2d")).createImageData(u.width,u.height));let a=t.getContext("2d").getImageData(0,0,t.width,t.height).data,e=w.data,i=0,r=t.width*t.height*4;for(let t=3;t<r;t+=4){let r=a[t];e[i++]=r,e[i++]=r,e[i++]=r,e[i++]=255}return h.putImageData(w,0,0),u}(e))),(d={frame:s.frame,duration:m,alpha:g?a(t(g,n.alphaQuality)).frame:null}).trackNumber=1,d.timecode=Math.round(c),p.push(d),(c+=d.duration)>=5e3&&k()},this.complete=function(){let t,a,i,d,n,s,f,l;return o||L(),k(),t={id:475249515,data:E},r(a=new e(16+32*E.length),A.pos,t),A.write(a.getAsDataArray()),g.Cues.positionEBML.data=M(t.offset),i=new e(b.size),d=A.pos,r(i,b.dataOffset,b.data),A.seek(b.dataOffset),A.write(i.getAsDataArray()),A.seek(d),n=new e(8),s=A.pos,n.writeDoubleBE(m),A.seek(B.dataOffset),A.write(n.getAsDataArray()),A.seek(s),f=new e(10),l=A.pos,f.writeUnsignedIntBE(y.id),f.writeEBMLVarIntWidth(A.pos-y.dataOffset,5),A.seek(y.offset),A.write(f.getAsDataArray()),A.seek(l),A.complete("video/webm")},this.getWrittenSize=function(){return A.length},s={},[{quality:.95,transparent:!1,alphaQuality:void 0,fileWriter:null,fd:null,frameDuration:null,frameRate:null},n||{}].forEach(function(t){for(let a in t)Object.prototype.hasOwnProperty.call(t,a)&&(s[a]=t[a])}),n=s,function(){if(!n.frameDuration){if(n.frameRate)n.frameDuration=1e3/n.frameRate;else throw Error("Missing required frameDuration or frameRate setting")}n.quality=Math.max(Math.min(n.quality,.99999),0),void 0===n.alphaQuality?n.alphaQuality=n.quality:n.alphaQuality=Math.max(Math.min(n.alphaQuality,.99999),0)}()}};"undefined"!=typeof module&&void 0!==module.exports?module.exports=d:window.WebMWriter=d(window.ArrayBufferDataStream,window.BlobBuffer)}();
//# sourceMappingURL=index.dbcadfc6.js.map
